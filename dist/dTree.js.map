{"version":3,"sources":["dTree.js"],"names":[],"mappings":"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","file":"dTree.js","sourcesContent":["(function (global, factory) {\r\n\ttypeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\r\n\ttypeof define === 'function' && define.amd ? define(factory) :\r\n\t(global.dTree = factory());\r\n}(this, (function () { 'use strict';\r\n\r\nclass TreeBuilder {\r\n\r\n    constructor(root, siblings, opts) {\r\n      TreeBuilder.DEBUG_LEVEL = opts.debug ? 1 : 0;\r\n  \r\n      this.root = root;\r\n      this.siblings = siblings;\r\n      this.opts = opts;\r\n  \r\n      // flatten nodes\r\n      this.allNodes = this._flatten(this.root);\r\n  \r\n      // calculate node sizes\r\n      this.nodeSize = opts.callbacks.nodeSize.call(this,\r\n        // filter hidden and marriage nodes\r\n        _.filter(\r\n          this.allNodes,\r\n          node => !(node.hidden || _.get(node, 'data.isMarriage'))\r\n        ),\r\n        opts.nodeWidth,\r\n        opts.callbacks.textRenderer\r\n      );\r\n      this.marriageSize = opts.callbacks.marriageSize.call(this,\r\n        // filter hidden and non marriage nodes\r\n        _.filter(\r\n          this.allNodes,\r\n          node => !node.hidden && _.get(node, 'data.isMarriage')\r\n        ),\r\n        this.opts.marriageNodeSize\r\n      );\r\n    }\r\n  \r\n    create() {\r\n  \r\n      let opts = this.opts;\r\n      let allNodes = this.allNodes;\r\n      let nodeSize = this.nodeSize;\r\n  \r\n      let width = opts.width + opts.margin.left + opts.margin.right;\r\n      let height = opts.height + opts.margin.top + opts.margin.bottom;\r\n  \r\n      // create zoom handler\r\n      const zoom = this.zoom = d3.zoom()\r\n        .scaleExtent([0.1, 10])\r\n        .on('zoom', function () {\r\n          g.attr('transform', d3.event.transform);\r\n        });\r\n  \r\n      // make a svg\r\n      const svg = this.svg = d3.select(opts.target)\r\n        .append('svg')\r\n        .attr('viewBox', [0, 0, width, height])\r\n        .call(zoom);\r\n  \r\n      // create svg group that holds all nodes\r\n      const g = this.g = svg.append('g');\r\n  \r\n      // set zoom identity\r\n      svg.call(zoom.transform, d3.zoomIdentity.translate(width / 2, opts.margin.top).scale(1));\r\n  \r\n      // Compute the layout.\r\n      this.tree = d3.tree()\r\n        .nodeSize([nodeSize[0] * 2,\r\n                   opts.callbacks.nodeHeightSeperation.call(this, nodeSize[0], nodeSize[1])]);\r\n  \r\n      this.tree.separation(function separation(a, b) {\r\n        if (a.data.hidden || b.data.hidden) {\r\n          return 0.3;\r\n        } else {\r\n          return 0.6;\r\n        }\r\n      });\r\n  \r\n      this._update(this.root);\r\n  \r\n    }\r\n  \r\n    _update(source) {\r\n  \r\n      let opts = this.opts;\r\n      let allNodes = this.allNodes;\r\n      let nodeSize = this.nodeSize;\r\n      let marriageSize = this.marriageSize;\r\n  \r\n      let treenodes = this.tree(source);\r\n      let links = treenodes.links();\r\n  \r\n      // Create the link lines.\r\n      this.g.selectAll('.link')\r\n        .data(links)\r\n        .enter()\r\n        // filter links with no parents to prevent empty nodes\r\n        .filter(function(l) {\r\n          return !l.target.data.noParent;\r\n        })\r\n        .append('path')\r\n        .attr('class', opts.styles.linage)\r\n        .attr('d', this._elbow);\r\n  \r\n      let nodes = this.g.selectAll('.node')\r\n        .data(treenodes.descendants())\r\n        .enter();\r\n  \r\n      this._linkSiblings();\r\n  \r\n      // Draw siblings (marriage)\r\n      this.g.selectAll('.sibling')\r\n        .data(this.siblings)\r\n        .enter()\r\n        .append('path')\r\n        .attr('class', opts.styles.marriage)\r\n        .attr('d', _.bind(this._siblingLine, this));\r\n  \r\n      // Create the node rectangles.\r\n      nodes.append('foreignObject')\r\n        .filter(function(d) {\r\n          return d.data.hidden ? false : true;\r\n        })\r\n        .attr('x', function(d) {\r\n          return Math.round(d.x - d.cWidth / 2) + 'px';\r\n        })\r\n        .attr('y', function(d) {\r\n          return Math.round(d.y - d.cHeight / 2) + 'px';\r\n        })\r\n        .attr('width', function(d) {\r\n          return d.cWidth + 'px';\r\n        })\r\n        .attr('height', function(d) {\r\n          return d.cHeight + 'px';\r\n        })\r\n        .attr('id', function(d) {\r\n          return d.id;\r\n        })\r\n        .html(function(d) {\r\n          if (d.data.isMarriage) {\r\n            return opts.callbacks.marriageRenderer.call(this,\r\n              d.x,\r\n              d.y,\r\n              marriageSize[0],\r\n              marriageSize[1],\r\n              d.data.extra,\r\n              d.data.id,\r\n              d.data.class\r\n            )\r\n          } else {\r\n            return opts.callbacks.nodeRenderer.call(this,\r\n              d.data.name,\r\n              d.x,\r\n              d.y,\r\n              nodeSize[0],\r\n              nodeSize[1],\r\n              d.data.extra,\r\n              d.data.id,\r\n              d.data.class,\r\n              d.data.textClass,\r\n              opts.callbacks.textRenderer\r\n            )\r\n          }\r\n        })\r\n        .on('dblclick', function () {\r\n          // do not propagate a double click on a node\r\n          // to prevent the zoom from being triggered\r\n          d3.event.stopPropagation();\r\n        })\r\n        .on('click', function(d)  {\r\n          // ignore double-clicks and clicks on hidden nodes\r\n          if (d3.event.detail === 2 || d.data.hidden) {\r\n            return;\r\n          }\r\n          if (d.data.isMarriage) {\r\n            opts.callbacks.marriageClick.call(this, d.data.extra, d.data.id);\r\n          } else {\r\n            opts.callbacks.nodeClick.call(this, d.data.name, d.data.extra, d.data.id);\r\n          }\r\n        })\r\n        .on('contextmenu', function(d)  {\r\n          if (d.data.hidden) {\r\n            return;\r\n          }\r\n          d3.event.preventDefault();\r\n          if (d.data.isMarriage) {\r\n            opts.callbacks.marriageRightClick.call(this, d.data.extra, d.data.id);\r\n          } else {\r\n            opts.callbacks.nodeRightClick.call(this, d.data.name, d.data.extra, d.data.id);\r\n          }\r\n        });\r\n    }\r\n  \r\n    _flatten(root) {\r\n      let n = [];\r\n      let i = 0;\r\n  \r\n      function recurse(node) {\r\n        if (node.children) {\r\n          node.children.forEach(recurse);\r\n        }\r\n        if (!node.id) {\r\n          node.id = ++i;\r\n        }\r\n        n.push(node);\r\n      }\r\n      recurse(root);\r\n      return n;\r\n    }\r\n  \r\n    _elbow(d, i) {\r\n      if (d.target.data.noParent) {\r\n        return 'M0,0L0,0';\r\n      }\r\n      let ny = Math.round(d.target.y + (d.source.y - d.target.y) * 0.50);\r\n  \r\n      let linedata = [{\r\n        x: d.target.x,\r\n        y: d.target.y\r\n      }, {\r\n        x: d.target.x,\r\n        y: ny\r\n      }, {\r\n        x: d.source.x,\r\n        y: d.source.y\r\n      }];\r\n  \r\n      let fun = d3.line().curve(d3.curveStepAfter)\r\n        .x(function(d) {\r\n          return d.x;\r\n        })\r\n        .y(function(d) {\r\n          return d.y;\r\n        });\r\n      return fun(linedata);\r\n    }\r\n  \r\n    _linkSiblings() {\r\n  \r\n      let allNodes = this.allNodes;\r\n  \r\n      _.forEach(this.siblings, function(d) {\r\n        let start = allNodes.filter(function(v) {\r\n          return d.source.id == v.data.id;\r\n        });\r\n        let end = allNodes.filter(function(v) {\r\n          return d.target.id == v.data.id;\r\n        });\r\n        d.source.x = start[0].x;\r\n        d.source.y = start[0].y;\r\n        d.target.x = end[0].x;\r\n        d.target.y = end[0].y;\r\n  \r\n        let marriageId = (start[0].data.marriageNode != null ?\r\n                          start[0].data.marriageNode.id :\r\n                          end[0].data.marriageNode.id);\r\n        let marriageNode = allNodes.find(function(n) {\r\n          return n.data.id == marriageId;\r\n        });\r\n        d.source.marriageNode = marriageNode;\r\n        d.target.marriageNode = marriageNode;\r\n      });\r\n  \r\n    }\r\n  \r\n    _siblingLine(d, i) {\r\n  \r\n      let ny = Math.round(d.target.y + (d.source.y - d.target.y) * 0.50);\r\n      let nodeWidth = this.nodeSize[0];\r\n      let nodeHeight = this.nodeSize[1];\r\n  \r\n      // Not first marriage\r\n      if (d.number > 0) {\r\n        ny -= Math.round(nodeHeight * 8 / 10);\r\n      }\r\n  \r\n      let linedata = [{\r\n        x: d.source.x,\r\n        y: d.source.y\r\n      }, {\r\n        x: Math.round(d.source.x + nodeWidth * 6 / 10),\r\n        y: d.source.y\r\n      }, {\r\n        x: Math.round(d.source.x + nodeWidth * 6 / 10),\r\n        y: ny\r\n      }, {\r\n        x: d.target.marriageNode.x,\r\n        y: ny\r\n      }, {\r\n        x: d.target.marriageNode.x,\r\n        y: d.target.y\r\n      }, {\r\n        x: d.target.x,\r\n        y: d.target.y\r\n      }];\r\n  \r\n      let fun = d3.line().curve(d3.curveStepAfter)\r\n        .x(function(d) {\r\n          return d.x;\r\n        })\r\n        .y(function(d) {\r\n          return d.y;\r\n        });\r\n      return fun(linedata);\r\n    }\r\n  \r\n    static _nodeHeightSeperation(nodeWidth, nodeMaxHeight) {\r\n      return nodeMaxHeight + 25;\r\n    }\r\n  \r\n    static _nodeSize(nodes, width, textRenderer) {\r\n      let maxWidth = 0;\r\n      let maxHeight = 0;\r\n      let tmpSvg = document.createElement('svg');\r\n      document.body.appendChild(tmpSvg);\r\n  \r\n      _.map(nodes, function(n) {\r\n        let container = document.createElement('div');\r\n        container.setAttribute('class', n.data.class);\r\n        container.style.visibility = 'hidden';\r\n        container.style.maxWidth = width + 'px';\r\n  \r\n        let text = textRenderer(n.data.name, n.data.extra, n.data.textClass);\r\n        container.innerHTML = text;\r\n  \r\n        tmpSvg.appendChild(container);\r\n        let height = container.offsetHeight;\r\n        tmpSvg.removeChild(container);\r\n  \r\n        maxHeight = Math.max(maxHeight, height);\r\n        n.cHeight = height;\r\n        if (n.data.hidden) {\r\n          n.cWidth = 0;\r\n        } else {\r\n          n.cWidth = width;\r\n        }\r\n      });\r\n      document.body.removeChild(tmpSvg);\r\n  \r\n      return [width, maxHeight];\r\n    }\r\n  \r\n    static _marriageSize (nodes, size) {\r\n      _.map(nodes, function (n) {\r\n        if (!n.data.hidden) {\r\n          n.cHeight = size;\r\n          n.cWidth = size;\r\n        }\r\n      });\r\n  \r\n      return [size, size]\r\n    }\r\n  \r\n    static _nodeRenderer(name, x, y, height, width, extra, id, nodeClass, textClass, textRenderer) {\r\n      let node = '';\r\n      node += '<div ';\r\n      node += 'style=\"height:100%;width:100%;\" ';\r\n      node += 'class=\"' + nodeClass + '\" ';\r\n      node += 'id=\"node' + id + '\">\\n';\r\n      node += textRenderer(name, extra, textClass);\r\n      node += '</div>';\r\n      return node;\r\n    }\r\n  \r\n    static _textRenderer(name, extra, textClass) {\r\n      let node = '';\r\n      node += '<p ';\r\n      node += 'align=\"center\" ';\r\n      node += 'class=\"' + textClass + '\">\\n';\r\n      node += name;\r\n      node += '</p>\\n';\r\n      return node;\r\n    }\r\n  \r\n    static _marriageRenderer (x, y, height, width, extra, id, nodeClass) {\r\n      return `<div style=\"height:100%\" class=\"${nodeClass}\" id=\"node${id}\"></div>`\r\n    }\r\n  \r\n    static _debug(msg) {\r\n      if (TreeBuilder.DEBUG_LEVEL > 0)  {\r\n        console.log(msg);\r\n      }\r\n    }\r\n  \r\n  }\r\n\r\nconst dTree = {\r\n\r\n  VERSION: '2.4.1',\r\n\r\n  init: function(data, options = {}) {\r\n\r\n    var opts = _.defaultsDeep(options || {}, {\r\n      target: '#graph',\r\n      debug: false,\r\n      width: 600,\r\n      height: 600,\r\n      hideMarriageNodes: true,\r\n      callbacks: {\r\n        nodeClick: function(name, extra, id) {},\r\n        nodeRightClick: function(name, extra, id) {},\r\n        marriageClick: function(extra, id) {},\r\n        marriageRightClick: function(extra, id) {},\r\n        nodeHeightSeperation: function(nodeWidth, nodeMaxHeight) {\r\n          return TreeBuilder._nodeHeightSeperation(nodeWidth, nodeMaxHeight);\r\n        },\r\n        nodeRenderer: function(name, x, y, height, width, extra, id, nodeClass, textClass, textRenderer) {\r\n          return TreeBuilder._nodeRenderer(name, x, y, height, width, extra,\r\n            id,nodeClass, textClass, textRenderer);\r\n        },\r\n        nodeSize: function(nodes, width, textRenderer) {\r\n          return TreeBuilder._nodeSize(nodes, width, textRenderer);\r\n        },\r\n        nodeSorter: function(aName, aExtra, bName, bExtra) {return 0;},\r\n        textRenderer: function(name, extra, textClass) {\r\n          return TreeBuilder._textRenderer(name, extra, textClass);\r\n        },\r\n        marriageRenderer: function (x, y, height, width, extra, id, nodeClass) {\r\n          return TreeBuilder._marriageRenderer(x, y, height, width, extra, id, nodeClass)\r\n        },\r\n        marriageSize: function (nodes, size) {\r\n          return TreeBuilder._marriageSize(nodes, size)\r\n        },\r\n      },\r\n      margin: {\r\n        top: 0,\r\n        right: 0,\r\n        bottom: 0,\r\n        left: 0\r\n      },\r\n      nodeWidth: 100,\r\n      marriageNodeSize: 10,\r\n      styles: {\r\n        node: 'node',\r\n        marriageNode: 'marriageNode',\r\n        linage: 'linage',\r\n        marriage: 'marriage',\r\n        text: 'nodeText'\r\n      }\r\n    });\r\n\r\n    var data = this._preprocess(data, opts);\r\n    var treeBuilder = new TreeBuilder(data.root, data.siblings, opts);\r\n    treeBuilder.create();\r\n\r\n    function _zoomTo (x, y, zoom = 1, duration = 500) {\r\n      treeBuilder.svg\r\n        .transition()\r\n        .duration(duration)\r\n        .call(\r\n          treeBuilder.zoom.transform,\r\n          d3.zoomIdentity\r\n            .translate(opts.width / 2, opts.height / 2)\r\n            .scale(zoom)\r\n            .translate(-x, -y)\r\n        );\r\n    }\r\n\r\n    return {\r\n      resetZoom: function (duration = 500) {\r\n        treeBuilder.svg\r\n          .transition()\r\n          .duration(duration)\r\n          .call(\r\n            treeBuilder.zoom.transform,\r\n            d3.zoomIdentity.translate(opts.width / 2, opts.margin.top).scale(1)\r\n          );\r\n      },\r\n      zoomTo: _zoomTo,\r\n      zoomToNode: function (nodeId, zoom = 2, duration = 500) {\r\n        const node = _.find(treeBuilder.allNodes, {data: {id: nodeId}});\r\n        if (node) {\r\n          _zoomTo(node.x, node.y, zoom, duration);\r\n        }\r\n      },\r\n      zoomToFit: function (duration = 500) {\r\n        const groupBounds = treeBuilder.g.node().getBBox();\r\n        const width = groupBounds.width;\r\n        const height = groupBounds.height;\r\n        const fullWidth = treeBuilder.svg.node().clientWidth;\r\n        const fullHeight = treeBuilder.svg.node().clientHeight;\r\n        const scale = 0.95 / Math.max(width / fullWidth, height / fullHeight);\r\n\r\n        treeBuilder.svg\r\n          .transition()\r\n          .duration(duration)\r\n          .call(\r\n            treeBuilder.zoom.transform,\r\n            d3.zoomIdentity\r\n              .translate(\r\n                fullWidth / 2 - scale * (groupBounds.x + width / 2),\r\n                fullHeight / 2 - scale * (groupBounds.y + height / 2)\r\n              )\r\n              .scale(scale)\r\n          );\r\n      }\r\n    }\r\n  },\r\n\r\n  _preprocess: function(data, opts) {\r\n\r\n    var siblings = [];\r\n    var id = 0;\r\n\r\n    var root = {\r\n      name: '',\r\n      id: id++,\r\n      hidden: true,\r\n      children: []\r\n    };\r\n\r\n    var reconstructTree = function(person, parent) {\r\n\r\n      // convert to person to d3 node\r\n      var node = {\r\n        name: person.name,\r\n        id: id++,\r\n        hidden: false,\r\n        children: [],\r\n        extra: person.extra,\r\n        textClass: person.textClass ? person.textClass : opts.styles.text,\r\n        class: person.class ? person.class : opts.styles.node\r\n      };\r\n\r\n      // hide linages to the hidden root node\r\n      if (parent == root) {\r\n        node.noParent = true;\r\n      }\r\n\r\n      // apply depth offset\r\n      for (var i = 0; i < person.depthOffset; i++) {\r\n        var pushNode = {\r\n          name: '',\r\n          id: id++,\r\n          hidden: true,\r\n          children: [],\r\n          noParent: node.noParent\r\n        };\r\n        parent.children.push(pushNode);\r\n        parent = pushNode;\r\n      }\r\n\r\n      // sort children\r\n      dTree._sortPersons(person.children, opts);\r\n\r\n      // add \"direct\" children\r\n      _.forEach(person.children, function(child) {\r\n        reconstructTree(child, node);\r\n      });\r\n\r\n      parent.children.push(node);\r\n\r\n      //sort marriages\r\n      dTree._sortMarriages(person.marriages, opts);\r\n\r\n      // go through marriage\r\n      _.forEach(person.marriages, function(marriage, index) {\r\n        var m = {\r\n          name: '',\r\n          id: id++,\r\n          hidden: opts.hideMarriageNodes,\r\n          noParent: true,\r\n          children: [],\r\n          isMarriage: true,\r\n          extra: marriage.extra,\r\n          class: marriage.class ? marriage.class : opts.styles.marriageNode\r\n        };\r\n\r\n        var sp = marriage.spouse;\r\n\r\n        var spouse = {\r\n          name: sp.name,\r\n          id: id++,\r\n          hidden: false,\r\n          noParent: true,\r\n          children: [],\r\n          textClass: sp.textClass ? sp.textClass : opts.styles.text,\r\n          class: sp.class ? sp.class : opts.styles.node,\r\n          extra: sp.extra,\r\n          marriageNode: m\r\n        };\r\n\r\n        parent.children.push(m, spouse);\r\n\r\n        dTree._sortPersons(marriage.children, opts);\r\n        _.forEach(marriage.children, function(child) {\r\n          reconstructTree(child, m);\r\n        });\r\n\r\n        siblings.push({\r\n          source: {\r\n            id: node.id\r\n          },\r\n          target: {\r\n            id: spouse.id\r\n          },\r\n          number: index\r\n        });\r\n      });\r\n\r\n    };\r\n\r\n    _.forEach(data, function(person) {\r\n      reconstructTree(person, root);\r\n    });\r\n\r\n    return {\r\n      root: d3.hierarchy(root),\r\n      siblings: siblings\r\n    };\r\n\r\n  },\r\n\r\n  _sortPersons: function(persons, opts) {\r\n    if (persons != undefined) {\r\n      persons.sort(function(a, b) {\r\n        return opts.callbacks.nodeSorter.call(this, a.name, a.extra, b.name, b.extra);\r\n      });\r\n    }\r\n    return persons;\r\n  },\r\n\r\n  _sortMarriages: function(marriages, opts) {\r\n    if (marriages != undefined && Array.isArray(marriages)) {\r\n      marriages.sort(function(marriageA, marriageB) {\r\n        var a = marriageA.spouse;\r\n        var b = marriageB.spouse;\r\n        return opts.callbacks.nodeSorter.call(this, a.name, a.extra, b.name, b.extra);\r\n      });\r\n    }\r\n    return marriages;\r\n  }\r\n\r\n};\r\n\r\nreturn dTree;\r\n\r\n})));\r\n"]}